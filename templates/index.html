<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Freedom Index</title>
    <link rel="stylesheet" href="/css/foundation.css">
    <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
<header class="site-header">
    <div class="grid-container">
        <div class="callout">
            <div class="top-bar">
                <div class="top-bar-left">
                    <ul class="menu">
                        <li class="menu-text brand">Freedom Index</li>
                    </ul>
                </div>
                <div class="top-bar-right">
                    <ul class="menu">
                        <li><a class="nav-active" href="/">Home</a></li>
                        <li><a href="/country/United States">Freedom Scores</a></li>
                        <li><a href="/rank/1">Rankings</a></li>
                        <li><a href="/year/2000">Year</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</header>

<main class="grid-container">
    
        <div class="grid-x grid-margin-x" style="margin-top: 1.5rem;">
            <div class="cell small-12 medium-6">
                <div class="card">
                    <div class="card-divider">
                        Explore Freedom Scores by Country
                    </div>
                    <div class="card-section">
                        <img src="/imgs/hongkong.jpg" alt="picture of hong kong" class="thumbnail" style="width:100%; height:200px; object-fit:cover; display:block;">
                        <a href="/country/Hong Kong SAR, China" class="button primary">View Country Data</a>
                    </div>
                </div>
            </div>
            <div class="cell small-12 medium-6">
                <div class="card">
                    <div class="card-divider">
                        Explore Rankings and Years
                    </div>
                    <div class="card-section">
                        <img src="/imgs/singapore.jpeg" alt="picture of singapore" class="thumbnail">
                        <div class="button-group">
                            <a href="/rank/1" class="button">Top Rankings</a>
                            <a href="/year/2023" class="button secondary">View Most Recent Data</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid-x grid-margin-x" style="margin-top: 1.5rem;">
            <div class="cell small-12">
                <div class="callout">
                    <h3 style="margin-top:0;">Top Countries — Freedom vs Components ({{chartYear}})</h3>
                    <canvas id="homeScatter" height="140"></canvas>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="/js/vendor/jquery.js"></script>
<script src="/js/vendor/foundation.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="application/json" id="homeLabels">{{homeLabels}}</script>
<script type="application/json" id="homeFreedom">{{homeFreedom}}</script>
<script type="application/json" id="homeSM">{{homeSM}}</script>
<script type="application/json" id="homeGS">{{homeGS}}</script>
<script type="application/json" id="homePR">{{homePR}}</script>
<script type="application/json" id="homeTR">{{homeTR}}</script>
<script>
  $(document).foundation();
</script>
<script>
(function(){
  function safeParse(id){
    try{
      const el = document.getElementById(id);
      if(!el) return [];
      const t = (el.textContent||'').trim();
      if(!t) return [];
      return JSON.parse(t);
    }catch(_){return []}
  }
  const ctx = document.getElementById('homeScatter');
  if(!ctx) return;
  const labels = safeParse('homeLabels');
  const dsFreedom = safeParse('homeFreedom');
  const dsSM = safeParse('homeSM');
  const dsGS = safeParse('homeGS');
  const dsPR = safeParse('homePR');
  const dsTR = safeParse('homeTR');
  new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [
        {label: 'Freedom Index', data: dsFreedom, backgroundColor: 'rgba(0,0,0,0.8)'},
        {label: 'Sound Money', data: dsSM, backgroundColor: 'rgba(54,162,235,0.7)'},
        {label: 'Size of Government', data: dsGS, backgroundColor: 'rgba(255,99,132,0.7)'},
        {label: 'Property Rights', data: dsPR, backgroundColor: 'rgba(75,192,192,0.7)'},
        {label: 'Trade Freedom', data: dsTR, backgroundColor: 'rgba(255,159,64,0.7)'}
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        tooltip: {
          callbacks: {
            title(items){
              if(!items || !items.length) return '';
              const x = items[0].parsed.x|0;
              return labels[x] ?? '';
            }
          }
        },
        title: { display: true, text: 'Top Countries — Freedom vs Components' }
      },
      scales: {
        x: {
          title: { display: true, text: 'Country' },
          beginAtZero: true,
          ticks: {
            callback: function(value){
              const idx = Number(value);
              return (Number.isInteger(idx) && labels[idx]) ? labels[idx] : '';
            },
            maxRotation: 60,
            minRotation: 0,
            autoSkip: true,
            maxTicksLimit: 20
          }
        },
        y: { title: { display: true, text: 'Score (0-10)' }, beginAtZero: true, suggestedMax: 10 }
      }
    }
  });
})();
</script>
</body>
</html>